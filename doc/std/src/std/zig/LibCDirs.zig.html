<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>zig/LibCDirs.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgklEQVR4AWMYWuD7EllJIM4G4g4g5oIJ/odhOJ8wToOxSTXgNxDHoeiBMfA4+wGShjyYOCkG/IGqWQziEzYAoUAeiF9D5U+DxEg14DRU7jWIT5IBIOdCxf+A+CQZAAoopEB7QJwBCBwHiip8UYmRdrAlDpIMgApwQZNnNii5Dq0MBgCxxycBnwEd+wAAAABJRU5ErkJggg==">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNTMgMTQwIj48ZyBmaWxsPSIjRjdBNDFEIj48Zz48cG9seWdvbiBwb2ludHM9IjQ2LDIyIDI4LDQ0IDE5LDMwIi8+PHBvbHlnb24gcG9pbnRzPSI0NiwyMiAzMywzMyAyOCw0NCAyMiw0NCAyMiw5NSAzMSw5NSAyMCwxMDAgMTIsMTE3IDAsMTE3IDAsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMzEsOTUgMTIsMTE3IDQsMTA2Ii8+PC9nPjxnPjxwb2x5Z29uIHBvaW50cz0iNTYsMjIgNjIsMzYgMzcsNDQiLz48cG9seWdvbiBwb2ludHM9IjU2LDIyIDExMSwyMiAxMTEsNDQgMzcsNDQgNTYsMzIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTE2LDk1IDk3LDExNyA5MCwxMDQiLz48cG9seWdvbiBwb2ludHM9IjExNiw5NSAxMDAsMTA0IDk3LDExNyA0MiwxMTcgNDIsOTUiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTUwLDAgNTIsMTE3IDMsMTQwIDEwMSwyMiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjE0MSwyMiAxNDAsNDAgMTIyLDQ1Ii8+PHBvbHlnb24gcG9pbnRzPSIxNTMsMjIgMTUzLDExNyAxMDYsMTE3IDEyMCwxMDUgMTI1LDk1IDEzMSw5NSAxMzEsNDUgMTIyLDQ1IDEzMiwzNiAxNDEsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTI1LDk1IDEzMCwxMTAgMTA2LDExNyIvPjwvZz48L2c+PC9zdmc+">
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1">libc_include_dir_list: []<span class="tok-kw">const</span> []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2">libc_installation: ?*<span class="tok-kw">const</span> LibCInstallation,</span>
<span class="line" id="L3">libc_framework_dir_list: []<span class="tok-kw">const</span> []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L4">sysroot: ?[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L5">darwin_sdk_layout: ?DarwinSdkLayout,</span>
<span class="line" id="L6"></span>
<span class="line" id="L7"><span class="tok-comment">/// The filesystem layout of darwin SDK elements.</span></span>
<span class="line" id="L8"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> DarwinSdkLayout = <span class="tok-kw">enum</span> {</span>
<span class="line" id="L9">    <span class="tok-comment">/// macOS SDK layout: TOP { /usr/include, /usr/lib, /System/Library/Frameworks }.</span></span>
<span class="line" id="L10">    sdk,</span>
<span class="line" id="L11">    <span class="tok-comment">/// Shipped libc layout: TOP { /lib/libc/include,  /lib/libc/darwin, &lt;NONE&gt; }.</span></span>
<span class="line" id="L12">    vendored,</span>
<span class="line" id="L13">};</span>
<span class="line" id="L14"></span>
<span class="line" id="L15"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">detect</span>(</span>
<span class="line" id="L16">    arena: Allocator,</span>
<span class="line" id="L17">    zig_lib_dir: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L18">    target: std.Target,</span>
<span class="line" id="L19">    is_native_abi: <span class="tok-type">bool</span>,</span>
<span class="line" id="L20">    link_libc: <span class="tok-type">bool</span>,</span>
<span class="line" id="L21">    libc_installation: ?*<span class="tok-kw">const</span> LibCInstallation,</span>
<span class="line" id="L22">) !LibCDirs {</span>
<span class="line" id="L23">    <span class="tok-kw">if</span> (!link_libc) {</span>
<span class="line" id="L24">        <span class="tok-kw">return</span> .{</span>
<span class="line" id="L25">            .libc_include_dir_list = &amp;[<span class="tok-number">0</span>][]<span class="tok-type">u8</span>{},</span>
<span class="line" id="L26">            .libc_installation = <span class="tok-null">null</span>,</span>
<span class="line" id="L27">            .libc_framework_dir_list = &amp;.{},</span>
<span class="line" id="L28">            .sysroot = <span class="tok-null">null</span>,</span>
<span class="line" id="L29">            .darwin_sdk_layout = <span class="tok-null">null</span>,</span>
<span class="line" id="L30">        };</span>
<span class="line" id="L31">    }</span>
<span class="line" id="L32"></span>
<span class="line" id="L33">    <span class="tok-kw">if</span> (libc_installation) |lci| {</span>
<span class="line" id="L34">        <span class="tok-kw">return</span> detectFromInstallation(arena, target, lci);</span>
<span class="line" id="L35">    }</span>
<span class="line" id="L36"></span>
<span class="line" id="L37">    <span class="tok-comment">// If linking system libraries and targeting the native abi, default to</span>
</span>
<span class="line" id="L38">    <span class="tok-comment">// using the system libc installation.</span>
</span>
<span class="line" id="L39">    <span class="tok-kw">if</span> (is_native_abi <span class="tok-kw">and</span> !target.isMinGW()) {</span>
<span class="line" id="L40">        <span class="tok-kw">const</span> libc = <span class="tok-kw">try</span> arena.create(LibCInstallation);</span>
<span class="line" id="L41">        libc.* = LibCInstallation.findNative(.{ .allocator = arena, .target = target }) <span class="tok-kw">catch</span> |err| <span class="tok-kw">switch</span> (err) {</span>
<span class="line" id="L42">            <span class="tok-kw">error</span>.CCompilerExitCode,</span>
<span class="line" id="L43">            <span class="tok-kw">error</span>.CCompilerCrashed,</span>
<span class="line" id="L44">            <span class="tok-kw">error</span>.CCompilerCannotFindHeaders,</span>
<span class="line" id="L45">            <span class="tok-kw">error</span>.UnableToSpawnCCompiler,</span>
<span class="line" id="L46">            <span class="tok-kw">error</span>.DarwinSdkNotFound,</span>
<span class="line" id="L47">            =&gt; |e| {</span>
<span class="line" id="L48">                <span class="tok-comment">// We tried to integrate with the native system C compiler,</span>
</span>
<span class="line" id="L49">                <span class="tok-comment">// however, it is not installed. So we must rely on our bundled</span>
</span>
<span class="line" id="L50">                <span class="tok-comment">// libc files.</span>
</span>
<span class="line" id="L51">                <span class="tok-kw">if</span> (std.zig.target.canBuildLibC(target)) {</span>
<span class="line" id="L52">                    <span class="tok-kw">return</span> detectFromBuilding(arena, zig_lib_dir, target);</span>
<span class="line" id="L53">                }</span>
<span class="line" id="L54">                <span class="tok-kw">return</span> e;</span>
<span class="line" id="L55">            },</span>
<span class="line" id="L56">            <span class="tok-kw">else</span> =&gt; |e| <span class="tok-kw">return</span> e,</span>
<span class="line" id="L57">        };</span>
<span class="line" id="L58">        <span class="tok-kw">return</span> detectFromInstallation(arena, target, libc);</span>
<span class="line" id="L59">    }</span>
<span class="line" id="L60"></span>
<span class="line" id="L61">    <span class="tok-comment">// If not linking system libraries, build and provide our own libc by</span>
</span>
<span class="line" id="L62">    <span class="tok-comment">// default if possible.</span>
</span>
<span class="line" id="L63">    <span class="tok-kw">if</span> (std.zig.target.canBuildLibC(target)) {</span>
<span class="line" id="L64">        <span class="tok-kw">return</span> detectFromBuilding(arena, zig_lib_dir, target);</span>
<span class="line" id="L65">    }</span>
<span class="line" id="L66"></span>
<span class="line" id="L67">    <span class="tok-comment">// If zig can't build the libc for the target and we are targeting the</span>
</span>
<span class="line" id="L68">    <span class="tok-comment">// native abi, fall back to using the system libc installation.</span>
</span>
<span class="line" id="L69">    <span class="tok-comment">// On windows, instead of the native (mingw) abi, we want to check</span>
</span>
<span class="line" id="L70">    <span class="tok-comment">// for the MSVC abi as a fallback.</span>
</span>
<span class="line" id="L71">    <span class="tok-kw">const</span> use_system_abi = <span class="tok-kw">if</span> (builtin.os.tag == .windows)</span>
<span class="line" id="L72">        target.abi == .msvc</span>
<span class="line" id="L73">    <span class="tok-kw">else</span></span>
<span class="line" id="L74">        is_native_abi;</span>
<span class="line" id="L75"></span>
<span class="line" id="L76">    <span class="tok-kw">if</span> (use_system_abi) {</span>
<span class="line" id="L77">        <span class="tok-kw">const</span> libc = <span class="tok-kw">try</span> arena.create(LibCInstallation);</span>
<span class="line" id="L78">        libc.* = <span class="tok-kw">try</span> LibCInstallation.findNative(.{ .allocator = arena, .verbose = <span class="tok-null">true</span>, .target = target });</span>
<span class="line" id="L79">        <span class="tok-kw">return</span> detectFromInstallation(arena, target, libc);</span>
<span class="line" id="L80">    }</span>
<span class="line" id="L81"></span>
<span class="line" id="L82">    <span class="tok-kw">return</span> .{</span>
<span class="line" id="L83">        .libc_include_dir_list = &amp;[<span class="tok-number">0</span>][]<span class="tok-type">u8</span>{},</span>
<span class="line" id="L84">        .libc_installation = <span class="tok-null">null</span>,</span>
<span class="line" id="L85">        .libc_framework_dir_list = &amp;.{},</span>
<span class="line" id="L86">        .sysroot = <span class="tok-null">null</span>,</span>
<span class="line" id="L87">        .darwin_sdk_layout = <span class="tok-null">null</span>,</span>
<span class="line" id="L88">    };</span>
<span class="line" id="L89">}</span>
<span class="line" id="L90"></span>
<span class="line" id="L91"><span class="tok-kw">fn</span> <span class="tok-fn">detectFromInstallation</span>(arena: Allocator, target: std.Target, lci: *<span class="tok-kw">const</span> LibCInstallation) !LibCDirs {</span>
<span class="line" id="L92">    <span class="tok-kw">var</span> list = <span class="tok-kw">try</span> std.ArrayList([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>).initCapacity(arena, <span class="tok-number">5</span>);</span>
<span class="line" id="L93">    <span class="tok-kw">var</span> framework_list = std.ArrayList([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>).init(arena);</span>
<span class="line" id="L94"></span>
<span class="line" id="L95">    list.appendAssumeCapacity(lci.include_dir.?);</span>
<span class="line" id="L96"></span>
<span class="line" id="L97">    <span class="tok-kw">const</span> is_redundant = std.mem.eql(<span class="tok-type">u8</span>, lci.sys_include_dir.?, lci.include_dir.?);</span>
<span class="line" id="L98">    <span class="tok-kw">if</span> (!is_redundant) list.appendAssumeCapacity(lci.sys_include_dir.?);</span>
<span class="line" id="L99"></span>
<span class="line" id="L100">    <span class="tok-kw">if</span> (target.os.tag == .windows) {</span>
<span class="line" id="L101">        <span class="tok-kw">if</span> (std.fs.path.dirname(lci.sys_include_dir.?)) |sys_include_dir_parent| {</span>
<span class="line" id="L102">            <span class="tok-comment">// This include path will only exist when the optional &quot;Desktop development with C++&quot;</span>
</span>
<span class="line" id="L103">            <span class="tok-comment">// is installed. It contains headers, .rc files, and resources. It is especially</span>
</span>
<span class="line" id="L104">            <span class="tok-comment">// necessary when working with Windows resources.</span>
</span>
<span class="line" id="L105">            <span class="tok-kw">const</span> atlmfc_dir = <span class="tok-kw">try</span> std.fs.path.join(arena, &amp;[_][]<span class="tok-kw">const</span> <span class="tok-type">u8</span>{ sys_include_dir_parent, <span class="tok-str">&quot;atlmfc&quot;</span>, <span class="tok-str">&quot;include&quot;</span> });</span>
<span class="line" id="L106">            list.appendAssumeCapacity(atlmfc_dir);</span>
<span class="line" id="L107">        }</span>
<span class="line" id="L108">        <span class="tok-kw">if</span> (std.fs.path.dirname(lci.include_dir.?)) |include_dir_parent| {</span>
<span class="line" id="L109">            <span class="tok-kw">const</span> um_dir = <span class="tok-kw">try</span> std.fs.path.join(arena, &amp;[_][]<span class="tok-kw">const</span> <span class="tok-type">u8</span>{ include_dir_parent, <span class="tok-str">&quot;um&quot;</span> });</span>
<span class="line" id="L110">            list.appendAssumeCapacity(um_dir);</span>
<span class="line" id="L111"></span>
<span class="line" id="L112">            <span class="tok-kw">const</span> shared_dir = <span class="tok-kw">try</span> std.fs.path.join(arena, &amp;[_][]<span class="tok-kw">const</span> <span class="tok-type">u8</span>{ include_dir_parent, <span class="tok-str">&quot;shared&quot;</span> });</span>
<span class="line" id="L113">            list.appendAssumeCapacity(shared_dir);</span>
<span class="line" id="L114">        }</span>
<span class="line" id="L115">    }</span>
<span class="line" id="L116">    <span class="tok-kw">if</span> (target.os.tag == .haiku) {</span>
<span class="line" id="L117">        <span class="tok-kw">const</span> include_dir_path = lci.include_dir <span class="tok-kw">orelse</span> <span class="tok-kw">return</span> <span class="tok-kw">error</span>.LibCInstallationNotAvailable;</span>
<span class="line" id="L118">        <span class="tok-kw">const</span> os_dir = <span class="tok-kw">try</span> std.fs.path.join(arena, &amp;[_][]<span class="tok-kw">const</span> <span class="tok-type">u8</span>{ include_dir_path, <span class="tok-str">&quot;os&quot;</span> });</span>
<span class="line" id="L119">        list.appendAssumeCapacity(os_dir);</span>
<span class="line" id="L120">        <span class="tok-comment">// Errors.h</span>
</span>
<span class="line" id="L121">        <span class="tok-kw">const</span> os_support_dir = <span class="tok-kw">try</span> std.fs.path.join(arena, &amp;[_][]<span class="tok-kw">const</span> <span class="tok-type">u8</span>{ include_dir_path, <span class="tok-str">&quot;os/support&quot;</span> });</span>
<span class="line" id="L122">        list.appendAssumeCapacity(os_support_dir);</span>
<span class="line" id="L123"></span>
<span class="line" id="L124">        <span class="tok-kw">const</span> config_dir = <span class="tok-kw">try</span> std.fs.path.join(arena, &amp;[_][]<span class="tok-kw">const</span> <span class="tok-type">u8</span>{ include_dir_path, <span class="tok-str">&quot;config&quot;</span> });</span>
<span class="line" id="L125">        list.appendAssumeCapacity(config_dir);</span>
<span class="line" id="L126">    }</span>
<span class="line" id="L127"></span>
<span class="line" id="L128">    <span class="tok-kw">var</span> sysroot: ?[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-null">null</span>;</span>
<span class="line" id="L129"></span>
<span class="line" id="L130">    <span class="tok-kw">if</span> (target.isDarwin()) d: {</span>
<span class="line" id="L131">        <span class="tok-kw">const</span> down1 = std.fs.path.dirname(lci.sys_include_dir.?) <span class="tok-kw">orelse</span> <span class="tok-kw">break</span> :d;</span>
<span class="line" id="L132">        <span class="tok-kw">const</span> down2 = std.fs.path.dirname(down1) <span class="tok-kw">orelse</span> <span class="tok-kw">break</span> :d;</span>
<span class="line" id="L133">        <span class="tok-kw">try</span> framework_list.append(<span class="tok-kw">try</span> std.fs.path.join(arena, &amp;.{ down2, <span class="tok-str">&quot;System&quot;</span>, <span class="tok-str">&quot;Library&quot;</span>, <span class="tok-str">&quot;Frameworks&quot;</span> }));</span>
<span class="line" id="L134">        sysroot = down2;</span>
<span class="line" id="L135">    }</span>
<span class="line" id="L136"></span>
<span class="line" id="L137">    <span class="tok-kw">return</span> .{</span>
<span class="line" id="L138">        .libc_include_dir_list = list.items,</span>
<span class="line" id="L139">        .libc_installation = lci,</span>
<span class="line" id="L140">        .libc_framework_dir_list = framework_list.items,</span>
<span class="line" id="L141">        .sysroot = sysroot,</span>
<span class="line" id="L142">        .darwin_sdk_layout = <span class="tok-kw">if</span> (sysroot == <span class="tok-null">null</span>) <span class="tok-null">null</span> <span class="tok-kw">else</span> .sdk,</span>
<span class="line" id="L143">    };</span>
<span class="line" id="L144">}</span>
<span class="line" id="L145"></span>
<span class="line" id="L146"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">detectFromBuilding</span>(</span>
<span class="line" id="L147">    arena: Allocator,</span>
<span class="line" id="L148">    zig_lib_dir: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L149">    target: std.Target,</span>
<span class="line" id="L150">) !LibCDirs {</span>
<span class="line" id="L151">    <span class="tok-kw">const</span> s = std.fs.path.sep_str;</span>
<span class="line" id="L152"></span>
<span class="line" id="L153">    <span class="tok-kw">if</span> (target.isDarwin()) {</span>
<span class="line" id="L154">        <span class="tok-kw">const</span> list = <span class="tok-kw">try</span> arena.alloc([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, <span class="tok-number">1</span>);</span>
<span class="line" id="L155">        list[<span class="tok-number">0</span>] = <span class="tok-kw">try</span> std.fmt.allocPrint(</span>
<span class="line" id="L156">            arena,</span>
<span class="line" id="L157">            <span class="tok-str">&quot;{s}&quot;</span> ++ s ++ <span class="tok-str">&quot;libc&quot;</span> ++ s ++ <span class="tok-str">&quot;include&quot;</span> ++ s ++ <span class="tok-str">&quot;any-macos-any&quot;</span>,</span>
<span class="line" id="L158">            .{zig_lib_dir},</span>
<span class="line" id="L159">        );</span>
<span class="line" id="L160">        <span class="tok-kw">return</span> .{</span>
<span class="line" id="L161">            .libc_include_dir_list = list,</span>
<span class="line" id="L162">            .libc_installation = <span class="tok-null">null</span>,</span>
<span class="line" id="L163">            .libc_framework_dir_list = &amp;.{},</span>
<span class="line" id="L164">            .sysroot = <span class="tok-null">null</span>,</span>
<span class="line" id="L165">            .darwin_sdk_layout = .vendored,</span>
<span class="line" id="L166">        };</span>
<span class="line" id="L167">    }</span>
<span class="line" id="L168"></span>
<span class="line" id="L169">    <span class="tok-kw">const</span> generic_name = libCGenericName(target);</span>
<span class="line" id="L170">    <span class="tok-comment">// Some architectures are handled by the same set of headers.</span>
</span>
<span class="line" id="L171">    <span class="tok-kw">const</span> arch_name = <span class="tok-kw">if</span> (target.abi.isMusl())</span>
<span class="line" id="L172">        std.zig.target.muslArchNameHeaders(target.cpu.arch)</span>
<span class="line" id="L173">    <span class="tok-kw">else</span> <span class="tok-kw">if</span> (target.cpu.arch.isThumb())</span>
<span class="line" id="L174">        <span class="tok-comment">// ARM headers are valid for Thumb too.</span>
</span>
<span class="line" id="L175">        <span class="tok-kw">switch</span> (target.cpu.arch) {</span>
<span class="line" id="L176">            .thumb =&gt; <span class="tok-str">&quot;arm&quot;</span>,</span>
<span class="line" id="L177">            .thumbeb =&gt; <span class="tok-str">&quot;armeb&quot;</span>,</span>
<span class="line" id="L178">            <span class="tok-kw">else</span> =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L179">        }</span>
<span class="line" id="L180">    <span class="tok-kw">else</span></span>
<span class="line" id="L181">        <span class="tok-builtin">@tagName</span>(target.cpu.arch);</span>
<span class="line" id="L182">    <span class="tok-kw">const</span> os_name = <span class="tok-builtin">@tagName</span>(target.os.tag);</span>
<span class="line" id="L183">    <span class="tok-comment">// Musl's headers are ABI-agnostic and so they all have the &quot;musl&quot; ABI name.</span>
</span>
<span class="line" id="L184">    <span class="tok-kw">const</span> abi_name = <span class="tok-kw">if</span> (target.abi.isMusl()) <span class="tok-str">&quot;musl&quot;</span> <span class="tok-kw">else</span> <span class="tok-builtin">@tagName</span>(target.abi);</span>
<span class="line" id="L185">    <span class="tok-kw">const</span> arch_include_dir = <span class="tok-kw">try</span> std.fmt.allocPrint(</span>
<span class="line" id="L186">        arena,</span>
<span class="line" id="L187">        <span class="tok-str">&quot;{s}&quot;</span> ++ s ++ <span class="tok-str">&quot;libc&quot;</span> ++ s ++ <span class="tok-str">&quot;include&quot;</span> ++ s ++ <span class="tok-str">&quot;{s}-{s}-{s}&quot;</span>,</span>
<span class="line" id="L188">        .{ zig_lib_dir, arch_name, os_name, abi_name },</span>
<span class="line" id="L189">    );</span>
<span class="line" id="L190">    <span class="tok-kw">const</span> generic_include_dir = <span class="tok-kw">try</span> std.fmt.allocPrint(</span>
<span class="line" id="L191">        arena,</span>
<span class="line" id="L192">        <span class="tok-str">&quot;{s}&quot;</span> ++ s ++ <span class="tok-str">&quot;libc&quot;</span> ++ s ++ <span class="tok-str">&quot;include&quot;</span> ++ s ++ <span class="tok-str">&quot;generic-{s}&quot;</span>,</span>
<span class="line" id="L193">        .{ zig_lib_dir, generic_name },</span>
<span class="line" id="L194">    );</span>
<span class="line" id="L195">    <span class="tok-kw">const</span> generic_arch_name = target.osArchName();</span>
<span class="line" id="L196">    <span class="tok-kw">const</span> arch_os_include_dir = <span class="tok-kw">try</span> std.fmt.allocPrint(</span>
<span class="line" id="L197">        arena,</span>
<span class="line" id="L198">        <span class="tok-str">&quot;{s}&quot;</span> ++ s ++ <span class="tok-str">&quot;libc&quot;</span> ++ s ++ <span class="tok-str">&quot;include&quot;</span> ++ s ++ <span class="tok-str">&quot;{s}-{s}-any&quot;</span>,</span>
<span class="line" id="L199">        .{ zig_lib_dir, generic_arch_name, os_name },</span>
<span class="line" id="L200">    );</span>
<span class="line" id="L201">    <span class="tok-kw">const</span> generic_os_include_dir = <span class="tok-kw">try</span> std.fmt.allocPrint(</span>
<span class="line" id="L202">        arena,</span>
<span class="line" id="L203">        <span class="tok-str">&quot;{s}&quot;</span> ++ s ++ <span class="tok-str">&quot;libc&quot;</span> ++ s ++ <span class="tok-str">&quot;include&quot;</span> ++ s ++ <span class="tok-str">&quot;any-{s}-any&quot;</span>,</span>
<span class="line" id="L204">        .{ zig_lib_dir, os_name },</span>
<span class="line" id="L205">    );</span>
<span class="line" id="L206"></span>
<span class="line" id="L207">    <span class="tok-kw">const</span> list = <span class="tok-kw">try</span> arena.alloc([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, <span class="tok-number">4</span>);</span>
<span class="line" id="L208">    list[<span class="tok-number">0</span>] = arch_include_dir;</span>
<span class="line" id="L209">    list[<span class="tok-number">1</span>] = generic_include_dir;</span>
<span class="line" id="L210">    list[<span class="tok-number">2</span>] = arch_os_include_dir;</span>
<span class="line" id="L211">    list[<span class="tok-number">3</span>] = generic_os_include_dir;</span>
<span class="line" id="L212"></span>
<span class="line" id="L213">    <span class="tok-kw">return</span> .{</span>
<span class="line" id="L214">        .libc_include_dir_list = list,</span>
<span class="line" id="L215">        .libc_installation = <span class="tok-null">null</span>,</span>
<span class="line" id="L216">        .libc_framework_dir_list = &amp;.{},</span>
<span class="line" id="L217">        .sysroot = <span class="tok-null">null</span>,</span>
<span class="line" id="L218">        .darwin_sdk_layout = .vendored,</span>
<span class="line" id="L219">    };</span>
<span class="line" id="L220">}</span>
<span class="line" id="L221"></span>
<span class="line" id="L222"><span class="tok-kw">fn</span> <span class="tok-fn">libCGenericName</span>(target: std.Target) [:<span class="tok-number">0</span>]<span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L223">    <span class="tok-kw">switch</span> (target.os.tag) {</span>
<span class="line" id="L224">        .windows =&gt; <span class="tok-kw">return</span> <span class="tok-str">&quot;mingw&quot;</span>,</span>
<span class="line" id="L225">        .macos, .ios, .tvos, .watchos =&gt; <span class="tok-kw">return</span> <span class="tok-str">&quot;darwin&quot;</span>,</span>
<span class="line" id="L226">        <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L227">    }</span>
<span class="line" id="L228">    <span class="tok-kw">switch</span> (target.abi) {</span>
<span class="line" id="L229">        .gnu,</span>
<span class="line" id="L230">        .gnuabin32,</span>
<span class="line" id="L231">        .gnuabi64,</span>
<span class="line" id="L232">        .gnueabi,</span>
<span class="line" id="L233">        .gnueabihf,</span>
<span class="line" id="L234">        .gnuf32,</span>
<span class="line" id="L235">        .gnuf64,</span>
<span class="line" id="L236">        .gnusf,</span>
<span class="line" id="L237">        .gnux32,</span>
<span class="line" id="L238">        .gnuilp32,</span>
<span class="line" id="L239">        =&gt; <span class="tok-kw">return</span> <span class="tok-str">&quot;glibc&quot;</span>,</span>
<span class="line" id="L240">        .musl,</span>
<span class="line" id="L241">        .musleabi,</span>
<span class="line" id="L242">        .musleabihf,</span>
<span class="line" id="L243">        .muslx32,</span>
<span class="line" id="L244">        .none,</span>
<span class="line" id="L245">        =&gt; <span class="tok-kw">return</span> <span class="tok-str">&quot;musl&quot;</span>,</span>
<span class="line" id="L246">        .code16,</span>
<span class="line" id="L247">        .eabi,</span>
<span class="line" id="L248">        .eabihf,</span>
<span class="line" id="L249">        .android,</span>
<span class="line" id="L250">        .msvc,</span>
<span class="line" id="L251">        .itanium,</span>
<span class="line" id="L252">        .cygnus,</span>
<span class="line" id="L253">        .coreclr,</span>
<span class="line" id="L254">        .simulator,</span>
<span class="line" id="L255">        .macabi,</span>
<span class="line" id="L256">        =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L257"></span>
<span class="line" id="L258">        .pixel,</span>
<span class="line" id="L259">        .vertex,</span>
<span class="line" id="L260">        .geometry,</span>
<span class="line" id="L261">        .hull,</span>
<span class="line" id="L262">        .domain,</span>
<span class="line" id="L263">        .compute,</span>
<span class="line" id="L264">        .library,</span>
<span class="line" id="L265">        .raygeneration,</span>
<span class="line" id="L266">        .intersection,</span>
<span class="line" id="L267">        .anyhit,</span>
<span class="line" id="L268">        .closesthit,</span>
<span class="line" id="L269">        .miss,</span>
<span class="line" id="L270">        .callable,</span>
<span class="line" id="L271">        .mesh,</span>
<span class="line" id="L272">        .amplification,</span>
<span class="line" id="L273">        =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L274">    }</span>
<span class="line" id="L275">}</span>
<span class="line" id="L276"></span>
<span class="line" id="L277"><span class="tok-kw">const</span> LibCDirs = <span class="tok-builtin">@This</span>();</span>
<span class="line" id="L278"><span class="tok-kw">const</span> builtin = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;builtin&quot;</span>);</span>
<span class="line" id="L279"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;../std.zig&quot;</span>);</span>
<span class="line" id="L280"><span class="tok-kw">const</span> LibCInstallation = std.zig.LibCInstallation;</span>
<span class="line" id="L281"><span class="tok-kw">const</span> Allocator = std.mem.Allocator;</span>
<span class="line" id="L282"></span>
</code></pre></body>
</html>