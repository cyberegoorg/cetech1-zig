<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>compress/flate/Token.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgklEQVR4AWMYWuD7EllJIM4G4g4g5oIJ/odhOJ8wToOxSTXgNxDHoeiBMfA4+wGShjyYOCkG/IGqWQziEzYAoUAeiF9D5U+DxEg14DRU7jWIT5IBIOdCxf+A+CQZAAoopEB7QJwBCBwHiip8UYmRdrAlDpIMgApwQZNnNii5Dq0MBgCxxycBnwEd+wAAAABJRU5ErkJggg==">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNTMgMTQwIj48ZyBmaWxsPSIjRjdBNDFEIj48Zz48cG9seWdvbiBwb2ludHM9IjQ2LDIyIDI4LDQ0IDE5LDMwIi8+PHBvbHlnb24gcG9pbnRzPSI0NiwyMiAzMywzMyAyOCw0NCAyMiw0NCAyMiw5NSAzMSw5NSAyMCwxMDAgMTIsMTE3IDAsMTE3IDAsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMzEsOTUgMTIsMTE3IDQsMTA2Ii8+PC9nPjxnPjxwb2x5Z29uIHBvaW50cz0iNTYsMjIgNjIsMzYgMzcsNDQiLz48cG9seWdvbiBwb2ludHM9IjU2LDIyIDExMSwyMiAxMTEsNDQgMzcsNDQgNTYsMzIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTE2LDk1IDk3LDExNyA5MCwxMDQiLz48cG9seWdvbiBwb2ludHM9IjExNiw5NSAxMDAsMTA0IDk3LDExNyA0MiwxMTcgNDIsOTUiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTUwLDAgNTIsMTE3IDMsMTQwIDEwMSwyMiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjE0MSwyMiAxNDAsNDAgMTIyLDQ1Ii8+PHBvbHlnb24gcG9pbnRzPSIxNTMsMjIgMTUzLDExNyAxMDYsMTE3IDEyMCwxMDUgMTI1LDk1IDEzMSw5NSAxMzEsNDUgMTIyLDQ1IDEzMiwzNiAxNDEsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTI1LDk1IDEzMCwxMTAgMTA2LDExNyIvPjwvZz48L2c+PC9zdmc+">
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1"><span class="tok-comment">//! Token cat be literal: single byte of data or match; reference to the slice of</span></span>
<span class="line" id="L2"><span class="tok-comment">//! data in the same stream represented with &lt;length, distance&gt;. Where length</span></span>
<span class="line" id="L3"><span class="tok-comment">//! can be 3 - 258 bytes, and distance 1 - 32768 bytes.</span></span>
<span class="line" id="L4"><span class="tok-comment">//!</span></span>
<span class="line" id="L5"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>);</span>
<span class="line" id="L6"><span class="tok-kw">const</span> assert = std.debug.assert;</span>
<span class="line" id="L7"><span class="tok-kw">const</span> print = std.debug.print;</span>
<span class="line" id="L8"><span class="tok-kw">const</span> expect = std.testing.expect;</span>
<span class="line" id="L9"><span class="tok-kw">const</span> consts = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;consts.zig&quot;</span>).match;</span>
<span class="line" id="L10"></span>
<span class="line" id="L11"><span class="tok-kw">const</span> Token = <span class="tok-builtin">@This</span>();</span>
<span class="line" id="L12"></span>
<span class="line" id="L13"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> Kind = <span class="tok-kw">enum</span>(<span class="tok-type">u1</span>) {</span>
<span class="line" id="L14">    literal,</span>
<span class="line" id="L15">    match,</span>
<span class="line" id="L16">};</span>
<span class="line" id="L17"></span>
<span class="line" id="L18"><span class="tok-comment">// Distance range 1 - 32768, stored in dist as 0 - 32767 (fits u15)</span>
</span>
<span class="line" id="L19">dist: <span class="tok-type">u15</span> = <span class="tok-number">0</span>,</span>
<span class="line" id="L20"><span class="tok-comment">// Length range 3 - 258, stored in len_lit as 0 - 255 (fits u8)</span>
</span>
<span class="line" id="L21">len_lit: <span class="tok-type">u8</span> = <span class="tok-number">0</span>,</span>
<span class="line" id="L22">kind: Kind = .literal,</span>
<span class="line" id="L23"></span>
<span class="line" id="L24"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">literal</span>(t: Token) <span class="tok-type">u8</span> {</span>
<span class="line" id="L25">    <span class="tok-kw">return</span> t.len_lit;</span>
<span class="line" id="L26">}</span>
<span class="line" id="L27"></span>
<span class="line" id="L28"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">distance</span>(t: Token) <span class="tok-type">u16</span> {</span>
<span class="line" id="L29">    <span class="tok-kw">return</span> <span class="tok-builtin">@as</span>(<span class="tok-type">u16</span>, t.dist) + consts.min_distance;</span>
<span class="line" id="L30">}</span>
<span class="line" id="L31"></span>
<span class="line" id="L32"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">length</span>(t: Token) <span class="tok-type">u16</span> {</span>
<span class="line" id="L33">    <span class="tok-kw">return</span> <span class="tok-builtin">@as</span>(<span class="tok-type">u16</span>, t.len_lit) + consts.base_length;</span>
<span class="line" id="L34">}</span>
<span class="line" id="L35"></span>
<span class="line" id="L36"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">initLiteral</span>(lit: <span class="tok-type">u8</span>) Token {</span>
<span class="line" id="L37">    <span class="tok-kw">return</span> .{ .kind = .literal, .len_lit = lit };</span>
<span class="line" id="L38">}</span>
<span class="line" id="L39"></span>
<span class="line" id="L40"><span class="tok-comment">// distance range 1 - 32768, stored in dist as 0 - 32767 (u15)</span>
</span>
<span class="line" id="L41"><span class="tok-comment">// length range 3 - 258, stored in len_lit as 0 - 255 (u8)</span>
</span>
<span class="line" id="L42"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">initMatch</span>(dist: <span class="tok-type">u16</span>, len: <span class="tok-type">u16</span>) Token {</span>
<span class="line" id="L43">    assert(len &gt;= consts.min_length <span class="tok-kw">and</span> len &lt;= consts.max_length);</span>
<span class="line" id="L44">    assert(dist &gt;= consts.min_distance <span class="tok-kw">and</span> dist &lt;= consts.max_distance);</span>
<span class="line" id="L45">    <span class="tok-kw">return</span> .{</span>
<span class="line" id="L46">        .kind = .match,</span>
<span class="line" id="L47">        .dist = <span class="tok-builtin">@intCast</span>(dist - consts.min_distance),</span>
<span class="line" id="L48">        .len_lit = <span class="tok-builtin">@intCast</span>(len - consts.base_length),</span>
<span class="line" id="L49">    };</span>
<span class="line" id="L50">}</span>
<span class="line" id="L51"></span>
<span class="line" id="L52"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">eql</span>(t: Token, o: Token) <span class="tok-type">bool</span> {</span>
<span class="line" id="L53">    <span class="tok-kw">return</span> t.kind == o.kind <span class="tok-kw">and</span></span>
<span class="line" id="L54">        t.dist == o.dist <span class="tok-kw">and</span></span>
<span class="line" id="L55">        t.len_lit == o.len_lit;</span>
<span class="line" id="L56">}</span>
<span class="line" id="L57"></span>
<span class="line" id="L58"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">lengthCode</span>(t: Token) <span class="tok-type">u16</span> {</span>
<span class="line" id="L59">    <span class="tok-kw">return</span> match_lengths[match_lengths_index[t.len_lit]].code;</span>
<span class="line" id="L60">}</span>
<span class="line" id="L61"></span>
<span class="line" id="L62"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">lengthEncoding</span>(t: Token) MatchLength {</span>
<span class="line" id="L63">    <span class="tok-kw">var</span> c = match_lengths[match_lengths_index[t.len_lit]];</span>
<span class="line" id="L64">    c.extra_length = t.len_lit - c.base_scaled;</span>
<span class="line" id="L65">    <span class="tok-kw">return</span> c;</span>
<span class="line" id="L66">}</span>
<span class="line" id="L67"></span>
<span class="line" id="L68"><span class="tok-comment">// Returns the distance code corresponding to a specific distance.</span>
</span>
<span class="line" id="L69"><span class="tok-comment">// Distance code is in range: 0 - 29.</span>
</span>
<span class="line" id="L70"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">distanceCode</span>(t: Token) <span class="tok-type">u8</span> {</span>
<span class="line" id="L71">    <span class="tok-kw">var</span> dist: <span class="tok-type">u16</span> = t.dist;</span>
<span class="line" id="L72">    <span class="tok-kw">if</span> (dist &lt; match_distances_index.len) {</span>
<span class="line" id="L73">        <span class="tok-kw">return</span> match_distances_index[dist];</span>
<span class="line" id="L74">    }</span>
<span class="line" id="L75">    dist &gt;&gt;= <span class="tok-number">7</span>;</span>
<span class="line" id="L76">    <span class="tok-kw">if</span> (dist &lt; match_distances_index.len) {</span>
<span class="line" id="L77">        <span class="tok-kw">return</span> match_distances_index[dist] + <span class="tok-number">14</span>;</span>
<span class="line" id="L78">    }</span>
<span class="line" id="L79">    dist &gt;&gt;= <span class="tok-number">7</span>;</span>
<span class="line" id="L80">    <span class="tok-kw">return</span> match_distances_index[dist] + <span class="tok-number">28</span>;</span>
<span class="line" id="L81">}</span>
<span class="line" id="L82"></span>
<span class="line" id="L83"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">distanceEncoding</span>(t: Token) MatchDistance {</span>
<span class="line" id="L84">    <span class="tok-kw">var</span> c = match_distances[t.distanceCode()];</span>
<span class="line" id="L85">    c.extra_distance = t.dist - c.base_scaled;</span>
<span class="line" id="L86">    <span class="tok-kw">return</span> c;</span>
<span class="line" id="L87">}</span>
<span class="line" id="L88"></span>
<span class="line" id="L89"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">lengthExtraBits</span>(code: <span class="tok-type">u32</span>) <span class="tok-type">u8</span> {</span>
<span class="line" id="L90">    <span class="tok-kw">return</span> match_lengths[code - length_codes_start].extra_bits;</span>
<span class="line" id="L91">}</span>
<span class="line" id="L92"></span>
<span class="line" id="L93"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">matchLength</span>(code: <span class="tok-type">u8</span>) MatchLength {</span>
<span class="line" id="L94">    <span class="tok-kw">return</span> match_lengths[code];</span>
<span class="line" id="L95">}</span>
<span class="line" id="L96"></span>
<span class="line" id="L97"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">matchDistance</span>(code: <span class="tok-type">u8</span>) MatchDistance {</span>
<span class="line" id="L98">    <span class="tok-kw">return</span> match_distances[code];</span>
<span class="line" id="L99">}</span>
<span class="line" id="L100"></span>
<span class="line" id="L101"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">distanceExtraBits</span>(code: <span class="tok-type">u32</span>) <span class="tok-type">u8</span> {</span>
<span class="line" id="L102">    <span class="tok-kw">return</span> match_distances[code].extra_bits;</span>
<span class="line" id="L103">}</span>
<span class="line" id="L104"></span>
<span class="line" id="L105"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">show</span>(t: Token) <span class="tok-type">void</span> {</span>
<span class="line" id="L106">    <span class="tok-kw">if</span> (t.kind == .literal) {</span>
<span class="line" id="L107">        print(<span class="tok-str">&quot;L('{c}'), &quot;</span>, .{t.literal()});</span>
<span class="line" id="L108">    } <span class="tok-kw">else</span> {</span>
<span class="line" id="L109">        print(<span class="tok-str">&quot;M({d}, {d}), &quot;</span>, .{ t.distance(), t.length() });</span>
<span class="line" id="L110">    }</span>
<span class="line" id="L111">}</span>
<span class="line" id="L112"></span>
<span class="line" id="L113"><span class="tok-comment">// Retruns index in match_lengths table for each length in range 0-255.</span>
</span>
<span class="line" id="L114"><span class="tok-kw">const</span> match_lengths_index = [_]<span class="tok-type">u8</span>{</span>
<span class="line" id="L115">    <span class="tok-number">0</span>,  <span class="tok-number">1</span>,  <span class="tok-number">2</span>,  <span class="tok-number">3</span>,  <span class="tok-number">4</span>,  <span class="tok-number">5</span>,  <span class="tok-number">6</span>,  <span class="tok-number">7</span>,  <span class="tok-number">8</span>,  <span class="tok-number">8</span>,</span>
<span class="line" id="L116">    <span class="tok-number">9</span>,  <span class="tok-number">9</span>,  <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>,</span>
<span class="line" id="L117">    <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>,</span>
<span class="line" id="L118">    <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">16</span>, <span class="tok-number">16</span>, <span class="tok-number">16</span>, <span class="tok-number">16</span>, <span class="tok-number">16</span>, <span class="tok-number">16</span>, <span class="tok-number">16</span>, <span class="tok-number">16</span>,</span>
<span class="line" id="L119">    <span class="tok-number">17</span>, <span class="tok-number">17</span>, <span class="tok-number">17</span>, <span class="tok-number">17</span>, <span class="tok-number">17</span>, <span class="tok-number">17</span>, <span class="tok-number">17</span>, <span class="tok-number">17</span>, <span class="tok-number">18</span>, <span class="tok-number">18</span>,</span>
<span class="line" id="L120">    <span class="tok-number">18</span>, <span class="tok-number">18</span>, <span class="tok-number">18</span>, <span class="tok-number">18</span>, <span class="tok-number">18</span>, <span class="tok-number">18</span>, <span class="tok-number">19</span>, <span class="tok-number">19</span>, <span class="tok-number">19</span>, <span class="tok-number">19</span>,</span>
<span class="line" id="L121">    <span class="tok-number">19</span>, <span class="tok-number">19</span>, <span class="tok-number">19</span>, <span class="tok-number">19</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>,</span>
<span class="line" id="L122">    <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>, <span class="tok-number">20</span>,</span>
<span class="line" id="L123">    <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>,</span>
<span class="line" id="L124">    <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">21</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>,</span>
<span class="line" id="L125">    <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">22</span>,</span>
<span class="line" id="L126">    <span class="tok-number">22</span>, <span class="tok-number">22</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>,</span>
<span class="line" id="L127">    <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">23</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>,</span>
<span class="line" id="L128">    <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>,</span>
<span class="line" id="L129">    <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>,</span>
<span class="line" id="L130">    <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>, <span class="tok-number">24</span>,</span>
<span class="line" id="L131">    <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>,</span>
<span class="line" id="L132">    <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>,</span>
<span class="line" id="L133">    <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">25</span>,</span>
<span class="line" id="L134">    <span class="tok-number">25</span>, <span class="tok-number">25</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>,</span>
<span class="line" id="L135">    <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>,</span>
<span class="line" id="L136">    <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>,</span>
<span class="line" id="L137">    <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">26</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>,</span>
<span class="line" id="L138">    <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>,</span>
<span class="line" id="L139">    <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>,</span>
<span class="line" id="L140">    <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">27</span>, <span class="tok-number">28</span>,</span>
<span class="line" id="L141">};</span>
<span class="line" id="L142"></span>
<span class="line" id="L143"><span class="tok-kw">const</span> MatchLength = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L144">    code: <span class="tok-type">u16</span>,</span>
<span class="line" id="L145">    base_scaled: <span class="tok-type">u8</span>, <span class="tok-comment">// base - 3, scaled to fit into u8 (0-255), same as lit_len field in Token.</span>
</span>
<span class="line" id="L146">    base: <span class="tok-type">u16</span>, <span class="tok-comment">// 3-258</span>
</span>
<span class="line" id="L147">    extra_length: <span class="tok-type">u8</span> = <span class="tok-number">0</span>,</span>
<span class="line" id="L148">    extra_bits: <span class="tok-type">u4</span>,</span>
<span class="line" id="L149">};</span>
<span class="line" id="L150"></span>
<span class="line" id="L151"><span class="tok-comment">// match_lengths represents table from rfc (https://datatracker.ietf.org/doc/html/rfc1951#page-12)</span>
</span>
<span class="line" id="L152"><span class="tok-comment">//</span>
</span>
<span class="line" id="L153"><span class="tok-comment">//      Extra               Extra               Extra</span>
</span>
<span class="line" id="L154"><span class="tok-comment">// Code Bits Length(s) Code Bits Lengths   Code Bits Length(s)</span>
</span>
<span class="line" id="L155"><span class="tok-comment">// ---- ---- ------     ---- ---- -------   ---- ---- -------</span>
</span>
<span class="line" id="L156"><span class="tok-comment">//  257   0     3       267   1   15,16     277   4   67-82</span>
</span>
<span class="line" id="L157"><span class="tok-comment">//  258   0     4       268   1   17,18     278   4   83-98</span>
</span>
<span class="line" id="L158"><span class="tok-comment">//  259   0     5       269   2   19-22     279   4   99-114</span>
</span>
<span class="line" id="L159"><span class="tok-comment">//  260   0     6       270   2   23-26     280   4  115-130</span>
</span>
<span class="line" id="L160"><span class="tok-comment">//  261   0     7       271   2   27-30     281   5  131-162</span>
</span>
<span class="line" id="L161"><span class="tok-comment">//  262   0     8       272   2   31-34     282   5  163-194</span>
</span>
<span class="line" id="L162"><span class="tok-comment">//  263   0     9       273   3   35-42     283   5  195-226</span>
</span>
<span class="line" id="L163"><span class="tok-comment">//  264   0    10       274   3   43-50     284   5  227-257</span>
</span>
<span class="line" id="L164"><span class="tok-comment">//  265   1  11,12      275   3   51-58     285   0    258</span>
</span>
<span class="line" id="L165"><span class="tok-comment">//  266   1  13,14      276   3   59-66</span>
</span>
<span class="line" id="L166"><span class="tok-comment">//</span>
</span>
<span class="line" id="L167"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> length_codes_start = <span class="tok-number">257</span>;</span>
<span class="line" id="L168"></span>
<span class="line" id="L169"><span class="tok-kw">const</span> match_lengths = [_]MatchLength{</span>
<span class="line" id="L170">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">0</span>, .base = <span class="tok-number">3</span>, .code = <span class="tok-number">257</span> },</span>
<span class="line" id="L171">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">1</span>, .base = <span class="tok-number">4</span>, .code = <span class="tok-number">258</span> },</span>
<span class="line" id="L172">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">2</span>, .base = <span class="tok-number">5</span>, .code = <span class="tok-number">259</span> },</span>
<span class="line" id="L173">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">3</span>, .base = <span class="tok-number">6</span>, .code = <span class="tok-number">260</span> },</span>
<span class="line" id="L174">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">4</span>, .base = <span class="tok-number">7</span>, .code = <span class="tok-number">261</span> },</span>
<span class="line" id="L175">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">5</span>, .base = <span class="tok-number">8</span>, .code = <span class="tok-number">262</span> },</span>
<span class="line" id="L176">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">6</span>, .base = <span class="tok-number">9</span>, .code = <span class="tok-number">263</span> },</span>
<span class="line" id="L177">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">7</span>, .base = <span class="tok-number">10</span>, .code = <span class="tok-number">264</span> },</span>
<span class="line" id="L178">    .{ .extra_bits = <span class="tok-number">1</span>, .base_scaled = <span class="tok-number">8</span>, .base = <span class="tok-number">11</span>, .code = <span class="tok-number">265</span> },</span>
<span class="line" id="L179">    .{ .extra_bits = <span class="tok-number">1</span>, .base_scaled = <span class="tok-number">10</span>, .base = <span class="tok-number">13</span>, .code = <span class="tok-number">266</span> },</span>
<span class="line" id="L180">    .{ .extra_bits = <span class="tok-number">1</span>, .base_scaled = <span class="tok-number">12</span>, .base = <span class="tok-number">15</span>, .code = <span class="tok-number">267</span> },</span>
<span class="line" id="L181">    .{ .extra_bits = <span class="tok-number">1</span>, .base_scaled = <span class="tok-number">14</span>, .base = <span class="tok-number">17</span>, .code = <span class="tok-number">268</span> },</span>
<span class="line" id="L182">    .{ .extra_bits = <span class="tok-number">2</span>, .base_scaled = <span class="tok-number">16</span>, .base = <span class="tok-number">19</span>, .code = <span class="tok-number">269</span> },</span>
<span class="line" id="L183">    .{ .extra_bits = <span class="tok-number">2</span>, .base_scaled = <span class="tok-number">20</span>, .base = <span class="tok-number">23</span>, .code = <span class="tok-number">270</span> },</span>
<span class="line" id="L184">    .{ .extra_bits = <span class="tok-number">2</span>, .base_scaled = <span class="tok-number">24</span>, .base = <span class="tok-number">27</span>, .code = <span class="tok-number">271</span> },</span>
<span class="line" id="L185">    .{ .extra_bits = <span class="tok-number">2</span>, .base_scaled = <span class="tok-number">28</span>, .base = <span class="tok-number">31</span>, .code = <span class="tok-number">272</span> },</span>
<span class="line" id="L186">    .{ .extra_bits = <span class="tok-number">3</span>, .base_scaled = <span class="tok-number">32</span>, .base = <span class="tok-number">35</span>, .code = <span class="tok-number">273</span> },</span>
<span class="line" id="L187">    .{ .extra_bits = <span class="tok-number">3</span>, .base_scaled = <span class="tok-number">40</span>, .base = <span class="tok-number">43</span>, .code = <span class="tok-number">274</span> },</span>
<span class="line" id="L188">    .{ .extra_bits = <span class="tok-number">3</span>, .base_scaled = <span class="tok-number">48</span>, .base = <span class="tok-number">51</span>, .code = <span class="tok-number">275</span> },</span>
<span class="line" id="L189">    .{ .extra_bits = <span class="tok-number">3</span>, .base_scaled = <span class="tok-number">56</span>, .base = <span class="tok-number">59</span>, .code = <span class="tok-number">276</span> },</span>
<span class="line" id="L190">    .{ .extra_bits = <span class="tok-number">4</span>, .base_scaled = <span class="tok-number">64</span>, .base = <span class="tok-number">67</span>, .code = <span class="tok-number">277</span> },</span>
<span class="line" id="L191">    .{ .extra_bits = <span class="tok-number">4</span>, .base_scaled = <span class="tok-number">80</span>, .base = <span class="tok-number">83</span>, .code = <span class="tok-number">278</span> },</span>
<span class="line" id="L192">    .{ .extra_bits = <span class="tok-number">4</span>, .base_scaled = <span class="tok-number">96</span>, .base = <span class="tok-number">99</span>, .code = <span class="tok-number">279</span> },</span>
<span class="line" id="L193">    .{ .extra_bits = <span class="tok-number">4</span>, .base_scaled = <span class="tok-number">112</span>, .base = <span class="tok-number">115</span>, .code = <span class="tok-number">280</span> },</span>
<span class="line" id="L194">    .{ .extra_bits = <span class="tok-number">5</span>, .base_scaled = <span class="tok-number">128</span>, .base = <span class="tok-number">131</span>, .code = <span class="tok-number">281</span> },</span>
<span class="line" id="L195">    .{ .extra_bits = <span class="tok-number">5</span>, .base_scaled = <span class="tok-number">160</span>, .base = <span class="tok-number">163</span>, .code = <span class="tok-number">282</span> },</span>
<span class="line" id="L196">    .{ .extra_bits = <span class="tok-number">5</span>, .base_scaled = <span class="tok-number">192</span>, .base = <span class="tok-number">195</span>, .code = <span class="tok-number">283</span> },</span>
<span class="line" id="L197">    .{ .extra_bits = <span class="tok-number">5</span>, .base_scaled = <span class="tok-number">224</span>, .base = <span class="tok-number">227</span>, .code = <span class="tok-number">284</span> },</span>
<span class="line" id="L198">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">255</span>, .base = <span class="tok-number">258</span>, .code = <span class="tok-number">285</span> },</span>
<span class="line" id="L199">};</span>
<span class="line" id="L200"></span>
<span class="line" id="L201"><span class="tok-comment">// Used in distanceCode fn to get index in match_distance table for each distance in range 0-32767.</span>
</span>
<span class="line" id="L202"><span class="tok-kw">const</span> match_distances_index = [_]<span class="tok-type">u8</span>{</span>
<span class="line" id="L203">    <span class="tok-number">0</span>,  <span class="tok-number">1</span>,  <span class="tok-number">2</span>,  <span class="tok-number">3</span>,  <span class="tok-number">4</span>,  <span class="tok-number">4</span>,  <span class="tok-number">5</span>,  <span class="tok-number">5</span>,  <span class="tok-number">6</span>,  <span class="tok-number">6</span>,  <span class="tok-number">6</span>,  <span class="tok-number">6</span>,  <span class="tok-number">7</span>,  <span class="tok-number">7</span>,  <span class="tok-number">7</span>,  <span class="tok-number">7</span>,</span>
<span class="line" id="L204">    <span class="tok-number">8</span>,  <span class="tok-number">8</span>,  <span class="tok-number">8</span>,  <span class="tok-number">8</span>,  <span class="tok-number">8</span>,  <span class="tok-number">8</span>,  <span class="tok-number">8</span>,  <span class="tok-number">8</span>,  <span class="tok-number">9</span>,  <span class="tok-number">9</span>,  <span class="tok-number">9</span>,  <span class="tok-number">9</span>,  <span class="tok-number">9</span>,  <span class="tok-number">9</span>,  <span class="tok-number">9</span>,  <span class="tok-number">9</span>,</span>
<span class="line" id="L205">    <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>, <span class="tok-number">10</span>,</span>
<span class="line" id="L206">    <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>, <span class="tok-number">11</span>,</span>
<span class="line" id="L207">    <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>,</span>
<span class="line" id="L208">    <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>, <span class="tok-number">12</span>,</span>
<span class="line" id="L209">    <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>,</span>
<span class="line" id="L210">    <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>, <span class="tok-number">13</span>,</span>
<span class="line" id="L211">    <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>,</span>
<span class="line" id="L212">    <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>,</span>
<span class="line" id="L213">    <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>,</span>
<span class="line" id="L214">    <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>, <span class="tok-number">14</span>,</span>
<span class="line" id="L215">    <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>,</span>
<span class="line" id="L216">    <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>,</span>
<span class="line" id="L217">    <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>,</span>
<span class="line" id="L218">    <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>, <span class="tok-number">15</span>,</span>
<span class="line" id="L219">};</span>
<span class="line" id="L220"></span>
<span class="line" id="L221"><span class="tok-kw">const</span> MatchDistance = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L222">    base_scaled: <span class="tok-type">u16</span>, <span class="tok-comment">// base - 1, same as Token dist field</span>
</span>
<span class="line" id="L223">    base: <span class="tok-type">u16</span>,</span>
<span class="line" id="L224">    extra_distance: <span class="tok-type">u16</span> = <span class="tok-number">0</span>,</span>
<span class="line" id="L225">    code: <span class="tok-type">u8</span>,</span>
<span class="line" id="L226">    extra_bits: <span class="tok-type">u4</span>,</span>
<span class="line" id="L227">};</span>
<span class="line" id="L228"></span>
<span class="line" id="L229"><span class="tok-comment">// match_distances represents table from rfc (https://datatracker.ietf.org/doc/html/rfc1951#page-12)</span>
</span>
<span class="line" id="L230"><span class="tok-comment">//</span>
</span>
<span class="line" id="L231"><span class="tok-comment">//      Extra           Extra               Extra</span>
</span>
<span class="line" id="L232"><span class="tok-comment">// Code Bits Dist  Code Bits   Dist     Code Bits Distance</span>
</span>
<span class="line" id="L233"><span class="tok-comment">// ---- ---- ----  ---- ----  ------    ---- ---- --------</span>
</span>
<span class="line" id="L234"><span class="tok-comment">//   0   0    1     10   4     33-48    20    9   1025-1536</span>
</span>
<span class="line" id="L235"><span class="tok-comment">//   1   0    2     11   4     49-64    21    9   1537-2048</span>
</span>
<span class="line" id="L236"><span class="tok-comment">//   2   0    3     12   5     65-96    22   10   2049-3072</span>
</span>
<span class="line" id="L237"><span class="tok-comment">//   3   0    4     13   5     97-128   23   10   3073-4096</span>
</span>
<span class="line" id="L238"><span class="tok-comment">//   4   1   5,6    14   6    129-192   24   11   4097-6144</span>
</span>
<span class="line" id="L239"><span class="tok-comment">//   5   1   7,8    15   6    193-256   25   11   6145-8192</span>
</span>
<span class="line" id="L240"><span class="tok-comment">//   6   2   9-12   16   7    257-384   26   12  8193-12288</span>
</span>
<span class="line" id="L241"><span class="tok-comment">//   7   2  13-16   17   7    385-512   27   12 12289-16384</span>
</span>
<span class="line" id="L242"><span class="tok-comment">//   8   3  17-24   18   8    513-768   28   13 16385-24576</span>
</span>
<span class="line" id="L243"><span class="tok-comment">//   9   3  25-32   19   8   769-1024   29   13 24577-32768</span>
</span>
<span class="line" id="L244"><span class="tok-comment">//</span>
</span>
<span class="line" id="L245"><span class="tok-kw">const</span> match_distances = [_]MatchDistance{</span>
<span class="line" id="L246">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">0x0000</span>, .code = <span class="tok-number">0</span>, .base = <span class="tok-number">1</span> },</span>
<span class="line" id="L247">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">0x0001</span>, .code = <span class="tok-number">1</span>, .base = <span class="tok-number">2</span> },</span>
<span class="line" id="L248">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">0x0002</span>, .code = <span class="tok-number">2</span>, .base = <span class="tok-number">3</span> },</span>
<span class="line" id="L249">    .{ .extra_bits = <span class="tok-number">0</span>, .base_scaled = <span class="tok-number">0x0003</span>, .code = <span class="tok-number">3</span>, .base = <span class="tok-number">4</span> },</span>
<span class="line" id="L250">    .{ .extra_bits = <span class="tok-number">1</span>, .base_scaled = <span class="tok-number">0x0004</span>, .code = <span class="tok-number">4</span>, .base = <span class="tok-number">5</span> },</span>
<span class="line" id="L251">    .{ .extra_bits = <span class="tok-number">1</span>, .base_scaled = <span class="tok-number">0x0006</span>, .code = <span class="tok-number">5</span>, .base = <span class="tok-number">7</span> },</span>
<span class="line" id="L252">    .{ .extra_bits = <span class="tok-number">2</span>, .base_scaled = <span class="tok-number">0x0008</span>, .code = <span class="tok-number">6</span>, .base = <span class="tok-number">9</span> },</span>
<span class="line" id="L253">    .{ .extra_bits = <span class="tok-number">2</span>, .base_scaled = <span class="tok-number">0x000c</span>, .code = <span class="tok-number">7</span>, .base = <span class="tok-number">13</span> },</span>
<span class="line" id="L254">    .{ .extra_bits = <span class="tok-number">3</span>, .base_scaled = <span class="tok-number">0x0010</span>, .code = <span class="tok-number">8</span>, .base = <span class="tok-number">17</span> },</span>
<span class="line" id="L255">    .{ .extra_bits = <span class="tok-number">3</span>, .base_scaled = <span class="tok-number">0x0018</span>, .code = <span class="tok-number">9</span>, .base = <span class="tok-number">25</span> },</span>
<span class="line" id="L256">    .{ .extra_bits = <span class="tok-number">4</span>, .base_scaled = <span class="tok-number">0x0020</span>, .code = <span class="tok-number">10</span>, .base = <span class="tok-number">33</span> },</span>
<span class="line" id="L257">    .{ .extra_bits = <span class="tok-number">4</span>, .base_scaled = <span class="tok-number">0x0030</span>, .code = <span class="tok-number">11</span>, .base = <span class="tok-number">49</span> },</span>
<span class="line" id="L258">    .{ .extra_bits = <span class="tok-number">5</span>, .base_scaled = <span class="tok-number">0x0040</span>, .code = <span class="tok-number">12</span>, .base = <span class="tok-number">65</span> },</span>
<span class="line" id="L259">    .{ .extra_bits = <span class="tok-number">5</span>, .base_scaled = <span class="tok-number">0x0060</span>, .code = <span class="tok-number">13</span>, .base = <span class="tok-number">97</span> },</span>
<span class="line" id="L260">    .{ .extra_bits = <span class="tok-number">6</span>, .base_scaled = <span class="tok-number">0x0080</span>, .code = <span class="tok-number">14</span>, .base = <span class="tok-number">129</span> },</span>
<span class="line" id="L261">    .{ .extra_bits = <span class="tok-number">6</span>, .base_scaled = <span class="tok-number">0x00c0</span>, .code = <span class="tok-number">15</span>, .base = <span class="tok-number">193</span> },</span>
<span class="line" id="L262">    .{ .extra_bits = <span class="tok-number">7</span>, .base_scaled = <span class="tok-number">0x0100</span>, .code = <span class="tok-number">16</span>, .base = <span class="tok-number">257</span> },</span>
<span class="line" id="L263">    .{ .extra_bits = <span class="tok-number">7</span>, .base_scaled = <span class="tok-number">0x0180</span>, .code = <span class="tok-number">17</span>, .base = <span class="tok-number">385</span> },</span>
<span class="line" id="L264">    .{ .extra_bits = <span class="tok-number">8</span>, .base_scaled = <span class="tok-number">0x0200</span>, .code = <span class="tok-number">18</span>, .base = <span class="tok-number">513</span> },</span>
<span class="line" id="L265">    .{ .extra_bits = <span class="tok-number">8</span>, .base_scaled = <span class="tok-number">0x0300</span>, .code = <span class="tok-number">19</span>, .base = <span class="tok-number">769</span> },</span>
<span class="line" id="L266">    .{ .extra_bits = <span class="tok-number">9</span>, .base_scaled = <span class="tok-number">0x0400</span>, .code = <span class="tok-number">20</span>, .base = <span class="tok-number">1025</span> },</span>
<span class="line" id="L267">    .{ .extra_bits = <span class="tok-number">9</span>, .base_scaled = <span class="tok-number">0x0600</span>, .code = <span class="tok-number">21</span>, .base = <span class="tok-number">1537</span> },</span>
<span class="line" id="L268">    .{ .extra_bits = <span class="tok-number">10</span>, .base_scaled = <span class="tok-number">0x0800</span>, .code = <span class="tok-number">22</span>, .base = <span class="tok-number">2049</span> },</span>
<span class="line" id="L269">    .{ .extra_bits = <span class="tok-number">10</span>, .base_scaled = <span class="tok-number">0x0c00</span>, .code = <span class="tok-number">23</span>, .base = <span class="tok-number">3073</span> },</span>
<span class="line" id="L270">    .{ .extra_bits = <span class="tok-number">11</span>, .base_scaled = <span class="tok-number">0x1000</span>, .code = <span class="tok-number">24</span>, .base = <span class="tok-number">4097</span> },</span>
<span class="line" id="L271">    .{ .extra_bits = <span class="tok-number">11</span>, .base_scaled = <span class="tok-number">0x1800</span>, .code = <span class="tok-number">25</span>, .base = <span class="tok-number">6145</span> },</span>
<span class="line" id="L272">    .{ .extra_bits = <span class="tok-number">12</span>, .base_scaled = <span class="tok-number">0x2000</span>, .code = <span class="tok-number">26</span>, .base = <span class="tok-number">8193</span> },</span>
<span class="line" id="L273">    .{ .extra_bits = <span class="tok-number">12</span>, .base_scaled = <span class="tok-number">0x3000</span>, .code = <span class="tok-number">27</span>, .base = <span class="tok-number">12289</span> },</span>
<span class="line" id="L274">    .{ .extra_bits = <span class="tok-number">13</span>, .base_scaled = <span class="tok-number">0x4000</span>, .code = <span class="tok-number">28</span>, .base = <span class="tok-number">16385</span> },</span>
<span class="line" id="L275">    .{ .extra_bits = <span class="tok-number">13</span>, .base_scaled = <span class="tok-number">0x6000</span>, .code = <span class="tok-number">29</span>, .base = <span class="tok-number">24577</span> },</span>
<span class="line" id="L276">};</span>
<span class="line" id="L277"></span>
<span class="line" id="L278"><span class="tok-kw">test</span> <span class="tok-str">&quot;size&quot;</span> {</span>
<span class="line" id="L279">    <span class="tok-kw">try</span> expect(<span class="tok-builtin">@sizeOf</span>(Token) == <span class="tok-number">4</span>);</span>
<span class="line" id="L280">}</span>
<span class="line" id="L281"></span>
<span class="line" id="L282"><span class="tok-comment">// testing table https://datatracker.ietf.org/doc/html/rfc1951#page-12</span>
</span>
<span class="line" id="L283"><span class="tok-kw">test</span> <span class="tok-str">&quot;MatchLength&quot;</span> {</span>
<span class="line" id="L284">    <span class="tok-kw">var</span> c = Token.initMatch(<span class="tok-number">1</span>, <span class="tok-number">4</span>).lengthEncoding();</span>
<span class="line" id="L285">    <span class="tok-kw">try</span> expect(c.code == <span class="tok-number">258</span>);</span>
<span class="line" id="L286">    <span class="tok-kw">try</span> expect(c.extra_bits == <span class="tok-number">0</span>);</span>
<span class="line" id="L287">    <span class="tok-kw">try</span> expect(c.extra_length == <span class="tok-number">0</span>);</span>
<span class="line" id="L288"></span>
<span class="line" id="L289">    c = Token.initMatch(<span class="tok-number">1</span>, <span class="tok-number">11</span>).lengthEncoding();</span>
<span class="line" id="L290">    <span class="tok-kw">try</span> expect(c.code == <span class="tok-number">265</span>);</span>
<span class="line" id="L291">    <span class="tok-kw">try</span> expect(c.extra_bits == <span class="tok-number">1</span>);</span>
<span class="line" id="L292">    <span class="tok-kw">try</span> expect(c.extra_length == <span class="tok-number">0</span>);</span>
<span class="line" id="L293"></span>
<span class="line" id="L294">    c = Token.initMatch(<span class="tok-number">1</span>, <span class="tok-number">12</span>).lengthEncoding();</span>
<span class="line" id="L295">    <span class="tok-kw">try</span> expect(c.code == <span class="tok-number">265</span>);</span>
<span class="line" id="L296">    <span class="tok-kw">try</span> expect(c.extra_bits == <span class="tok-number">1</span>);</span>
<span class="line" id="L297">    <span class="tok-kw">try</span> expect(c.extra_length == <span class="tok-number">1</span>);</span>
<span class="line" id="L298"></span>
<span class="line" id="L299">    c = Token.initMatch(<span class="tok-number">1</span>, <span class="tok-number">130</span>).lengthEncoding();</span>
<span class="line" id="L300">    <span class="tok-kw">try</span> expect(c.code == <span class="tok-number">280</span>);</span>
<span class="line" id="L301">    <span class="tok-kw">try</span> expect(c.extra_bits == <span class="tok-number">4</span>);</span>
<span class="line" id="L302">    <span class="tok-kw">try</span> expect(c.extra_length == <span class="tok-number">130</span> - <span class="tok-number">115</span>);</span>
<span class="line" id="L303">}</span>
<span class="line" id="L304"></span>
<span class="line" id="L305"><span class="tok-kw">test</span> <span class="tok-str">&quot;MatchDistance&quot;</span> {</span>
<span class="line" id="L306">    <span class="tok-kw">var</span> c = Token.initMatch(<span class="tok-number">1</span>, <span class="tok-number">4</span>).distanceEncoding();</span>
<span class="line" id="L307">    <span class="tok-kw">try</span> expect(c.code == <span class="tok-number">0</span>);</span>
<span class="line" id="L308">    <span class="tok-kw">try</span> expect(c.extra_bits == <span class="tok-number">0</span>);</span>
<span class="line" id="L309">    <span class="tok-kw">try</span> expect(c.extra_distance == <span class="tok-number">0</span>);</span>
<span class="line" id="L310"></span>
<span class="line" id="L311">    c = Token.initMatch(<span class="tok-number">192</span>, <span class="tok-number">4</span>).distanceEncoding();</span>
<span class="line" id="L312">    <span class="tok-kw">try</span> expect(c.code == <span class="tok-number">14</span>);</span>
<span class="line" id="L313">    <span class="tok-kw">try</span> expect(c.extra_bits == <span class="tok-number">6</span>);</span>
<span class="line" id="L314">    <span class="tok-kw">try</span> expect(c.extra_distance == <span class="tok-number">192</span> - <span class="tok-number">129</span>);</span>
<span class="line" id="L315">}</span>
<span class="line" id="L316"></span>
<span class="line" id="L317"><span class="tok-kw">test</span> <span class="tok-str">&quot;match_lengths&quot;</span> {</span>
<span class="line" id="L318">    <span class="tok-kw">for</span> (match_lengths, <span class="tok-number">0</span>..) |ml, i| {</span>
<span class="line" id="L319">        <span class="tok-kw">try</span> expect(<span class="tok-builtin">@as</span>(<span class="tok-type">u16</span>, ml.base_scaled) + <span class="tok-number">3</span> == ml.base);</span>
<span class="line" id="L320">        <span class="tok-kw">try</span> expect(i + <span class="tok-number">257</span> == ml.code);</span>
<span class="line" id="L321">    }</span>
<span class="line" id="L322"></span>
<span class="line" id="L323">    <span class="tok-kw">for</span> (match_distances, <span class="tok-number">0</span>..) |mo, i| {</span>
<span class="line" id="L324">        <span class="tok-kw">try</span> expect(mo.base_scaled + <span class="tok-number">1</span> == mo.base);</span>
<span class="line" id="L325">        <span class="tok-kw">try</span> expect(i == mo.code);</span>
<span class="line" id="L326">    }</span>
<span class="line" id="L327">}</span>
<span class="line" id="L328"></span>
</code></pre></body>
</html>